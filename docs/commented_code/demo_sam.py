from sam_analyzer import SamReader

def test_sam(file_path):
    """
    Выполняет базовую проверку работы SAM ридера на указанном файле.
    
    Эта функция тестирует основные возможности чтения SAM/BAM файлов:
    - Чтение заголовка файла
    - Подсчет количества выравниваний
    - Получение списка хромосом
    - Чтение первой записи для проверки формата данных
    
    Args:
        file_path (str): Путь к SAM/BAM файлу для тестирования
        
    Raises:
        Exception: Выводит любые ошибки, возникшие при работе с файлом
    """
    print("Testing SAM reader...")
    try:
        # Открываем файл с использованием контекстного менеджера
        # для гарантированного закрытия файла
        with SamReader(file_path) as reader:
            # Базовые методы ===========================================
            
            # Получаем заголовок файла (метаданные)
            header = reader.get_header()
            
            # Считаем общее количество выравниваний в файле
            count = reader.count_alignments()
            
            # Получаем список всех хромосом, присутствующих в файле
            chroms = reader.get_chromosomes()
            
            # Выводим основную информацию о файле ======================
            print(f"Header: {len(header)} lines")  # Количество строк в заголовке
            print(f"Alignments: {count}")  # Общее число выравниваний
            print(f"Chromosomes: {chroms[:3]}")  # Первые 3 хромосомы из списка

            # Чтение и вывод первой записи =============================
            # Используем итератор для чтения записей
            for rec in reader.read():
                # Выводим информацию о первой записи:
                # - Хромосома (chrom)
                # - Позиция начала выравнивания (start)
                print(f"First record: {rec.chrom}:{rec.start}")
                break  # Прерываем цикл после первой записи
                
    except Exception as e:
        # Обработка возможных ошибок при работе с файлом
        print(f"SAM Error: {e}")

if __name__ == "__main__":
    # Точка входа программы при прямом запуске скрипта
    
    # Запрашиваем путь к файлу у пользователя
    sam_file = input("Введи путь к SAM файлу: ")
    
    # Альтернативные варианты указания пути (раскомментировать при необходимости):
    # sam_file = "path/to/your/file.sam"  # Прямое указание пути
    # sam_file = "data/example.bam"       # Пример для BAM файла
    
    # Запускаем тестирование
    test_sam(sam_file)